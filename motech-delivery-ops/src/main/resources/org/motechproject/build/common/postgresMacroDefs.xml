<?xml version="1.0" encoding="UTF-8"?>
<antlib>
    <typedef resource="org/motechproject/build/common/envMacroDefs.xml"/>

    <!--TODO: Assumes unix family os -->
    <macrodef name="start.postgres">
        <sequential>
            <set.script.interpreter/>
            <set.service.home/>
            <echo message="Starting PostGres..."/>
            <exec executable="${script.interpreter}" dir="${service.home}" failonerror="true">
                <arg line="service postgresql start"/>
            </exec>
            <echo message="Started PostGres..."/>
        </sequential>
    </macrodef>

    <!--TODO: Assumes unix family os -->
    <macrodef name="stop.postgres">
        <sequential>
            <set.script.interpreter/>
            <set.service.home/>
            <echo message="Stopping PostGres..."/>
            <exec executable="${script.interpreter}" dir="${service.home}"  failonerror="true">
                <arg line="service postgresql stop"/>
            </exec>
            <echo message="Stopped PostGres..."/>
        </sequential>
    </macrodef>

    <macrodef name="restore.data.for.postgres.db.from.file.source">
        <attribute name="postgres.backup.folder"/>
        <attribute name="postgres.data.folder"/>
        <sequential>
            <echo message="Copying SQL form data fileset from backup at @{postgres.backup.folder} to SQL database at @{postgres.data.folder}"/>
            <copy todir="@{postgres.data.folder}">
                <fileset dir="@{postgres.backup.folder}"/>
            </copy>
            <echo message="PostGres Database restore successful."/>
        </sequential>
    </macrodef>

    <macrodef name="backup.postgres.files">
        <attribute name="postgres.data.folder"/>
        <attribute name="postgres.backup.folder"/>
        <sequential>
                    <echo message="Copying postgres data fileset from @{from} to backup at @{to}"/>
                    <copy todir="@{postgres.backup.folder}">
                        <fileset dir="@{postgres.data.folder}"/>
                    </copy>
                    <echo message="PostGres Database backup successful."/>
        </sequential>
    </macrodef>
</antlib>